<?php
/**
 * @file
 * Code for the F.A.Q feature.
 */

include_once('f_a_q.features.inc');

function f_a_q_init(){
}

/*
* hook_views_pre_render
*/
function f_a_q_views_pre_render(&$view) {
  if($view->name == 'faq') {
    //add a bit of jQuery to make it work
	drupal_add_js(drupal_get_path('module', 'f_a_q') .'/faq.js');
	
	//Build extra menu item for this view
	$output= '<ul class="well unstyled action_bar">';
	//Check permission
	 if (user_access('administer nodes')) {
		$output.= '<li class="f_right">'.l(t('create a new FAQ'),'node/add/f-a-q',array('attributes' => array('class' => array('btn info')))).'</li>';
	}  
	$output.= '<li class="expand btn small">'.l(t('Expand'),'').'</a></li>';
	$output.= '<li class="collapse btn small">'.l(t('Collapse'),'').'</a></li>';	

	$output.= '</ul>';
	
	//add menu to the exsiting  header
    $view->header['area']->options['content'] = $view->header['area']->options['content'] . $output;
  }
}

function f_a_q_enable(){
 drupal_set_message('FAQ enable', 'warning'); //OK

}

function f_a_q_modules_enabled($modules) {

 node_types_rebuild();
 drupal_set_message('node_type_insert', 'warning'); //OK
   if(in_array('f_a_q', $modules)) { 
	  //Get role_id for the role
	  $role_name='contributor';
	  $roles = user_roles(TRUE);
	  $role_id = array_search($role_name, $roles);
	  
		user_role_grant_permissions(4, array(
		  'create f_a_q content',
		  'edit any f_a_q content',
		  'delete any f_a_q content',
		));
	}
}
function f_a_q_disable() {

  _disable_content_type('f_a_q');
  
   //Get role_id for the role
  $role_name='contributor';
  $roles = user_roles(TRUE);
  $role_id = array_search($role_name, $roles);
  
	user_role_revoke_permissions($role_id, array(
	  'create f_a_q content',
	  'edit any f_a_q content',
	  'delete any f_a_q content',
	));
}
