<?php
/**
 * @file
 * Code for the F.A.Q feature.
 */

include_once('f_a_q.features.inc');

function f_a_q_init(){
}

/*
* hook_views_pre_render
*/
function f_a_q_views_pre_render(&$view) {
  if($view->name == 'faq') {
    //add a bit of jQuery to make it work
	drupal_add_js(drupal_get_path('module', 'f_a_q') .'/faq.js');
	
  $output = '';
  
	//Build extra menu item for this view
  $output .= l(t('Expand all'), '', array('attributes' => array('type' => 'expand', 'action_bar' => 'start', 'btn_group' => 'start')));
  $output .= l(t('Collapse'), '', array('attributes' => array('type' => 'collapse', 'btn_group' => 'end')));
  
  if (user_access('administer nodes')) { 
    $output .= l(t('Create a new FAQ'), 'node/add/f-a-q', array('attributes' => array('type' => 'add', 'action_bar' => 'end', 'btn_group' => 'single')));
  }
  
	//add menu to the exsiting  header
    $view->header['area']->options['content'] = $view->header['area']->options['content'] . $output;
  }
}

function f_a_q_enable(){
 drupal_set_message('FAQ enabled'); //OK

}

function f_a_q_modules_enabled($modules) {

 node_types_rebuild();

   if(in_array('f_a_q', $modules)) { 
	  //Get role_id for the role
	  $role_name='contributor';
	  $roles = user_roles(TRUE);
	  $role_id = array_search($role_name, $roles);
	  
		user_role_grant_permissions(4, array(
		  'create f_a_q content',
		  'edit any f_a_q content',
		  'delete any f_a_q content',
		));
	}
}
function f_a_q_disable() {

  _disable_content_type('f_a_q');
  
   //Get role_id for the role
  $role_name='contributor';
  $roles = user_roles(TRUE);
  $role_id = array_search($role_name, $roles);
  
	user_role_revoke_permissions($role_id, array(
	  'create f_a_q content',
	  'edit any f_a_q content',
	  'delete any f_a_q content',
	));
}
