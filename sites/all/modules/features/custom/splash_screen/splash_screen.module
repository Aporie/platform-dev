<?php

/**
 * @file
 * Code for the Splash_screen feature.
 */
include_once 'splash_screen.features.inc';


/*
 * hook_init
 */

function splash_screen_init() {
    global $base_url, $user;
    $isadmin = 0;
    if (in_array('administrator', array_values($user->roles))) {
	$isadmin = 1;
    }
    $cookie_name = variable_get("locale_cookie_language_negotiation_cookie_param");
    $path = drupal_get_path('module', 'splash_screen');
    drupal_add_js($path . '/splash.js', array('weight' => 1));
    
    $splash_screen_url = variable_get("splash_screen_url"); // TODO put these variables in a admin form settings
    drupal_add_js(array('splash_screen' => array(
    'base_url' => $base_url,
    'isadmin' => $isadmin,
    'cookie_name' => $cookie_name,
    'splash' => $splash_screen_url
    )), 'setting');
//    global $language, $user, $base_url;
//    if ($user->uid != 1) {
//        $splash_screen_url = variable_get("splash_screen_url"); // TODO put these variables in a admin form settings
//        $cookie_name = variable_get("locale_cookie_language_negotiation_cookie_param");
//        if (empty($_COOKIE[$cookie_name]) ) {
//                drupal_goto($splash_screen_url);
//        }
//
//    }
}


/**
 * Implements hook_menu().
 */
function splash_screen_menu() {
  $items['admin/config/splash_screen'] = array(
    'title' => 'Splash screen settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('form_splash_screen_settings'),
    'access arguments' => array('administer splash screen'),
  );
  $items['admin/config/splash_screen/settings'] = array(
    'title' => 'Splash screen settings',
    'description' => 'Configure the splash screen module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('form_splash_screen_settings'),
    'access arguments' => array('administer splash screen'),
  ); 
  return $items;
}


function form_splash_screen_settings($form, &$form_state) {
  $form['splash_screen_url'] = array(
    '#type' => 'text',
    '#title' => t('splash screen url'),
    '#default_value' => variable_get("splash_screen_url"),
  ); 
  $form['splash_screen_language_msg'] = array(
    '#type' => 'text',
    '#title' => t('splash screen language choice'),
    '#default_value' => variable_get("splash_screen_language_msg"),
  ); 
  return system_settings_form($form);
}

/**
 * Implements hook_permission().
 */
function hook_permission() {
  return array(
    'administer splash screen' => array(
      'title' => t('Administer slash screen'), 
      'description' => t('Administrer full settings of the splash screen module.'),
    ),
  );
}
