<?php

/**
 * @file
 * Code for the Splash_screen feature.
 */

/*
 * hook_init
 */

function splash_screen_init() {
  $cookie_name = variable_get('language_cookie_param','language');
  $splash_screen_url = variable_get("splash_screen_url");
  
  if (!isset($_COOKIE[$cookie_name]) && drupal_is_front_page()) {
    language_cookie_set('NULL');
    drupal_goto($splash_screen_url);
  }
}


/**
 * Implements hook_menu().
 */
function splash_screen_menu() {
  $items['admin/config/splash_screen'] = array(
    'title' => 'Splash screen settings',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('form_splash_screen_settings'),
    'access arguments' => array('administer splash screen'),
  );
  $items['admin/config/splash_screen/settings'] = array(
    'title' => 'Splash screen settings',
    'description' => 'Configure the splash screen module',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('form_splash_screen_settings'),
    'access arguments' => array('administer splash screen'),
  ); 
  return $items;
}


function form_splash_screen_settings($form, &$form_state) {
  $form['messages'] = array(
    '#type' => 'fieldset',
    '#title' => t('Message settings'),
  );
  $form['messages']['splash_screen_language_msg'] = array(
    '#type' => 'textfield',
    '#title' => t('Choose language'),
    '#default_value' => variable_get("splash_screen_language_msg"),
  );
  $form['URL'] = array(
    '#type' => 'fieldset',
    '#title' => t('Path settings'),
  );
   $form['URL']['splash_screen_url'] = array(
    '#type' => 'textfield',
    '#title' => t('URL of the splash screen'),
    '#default_value' => (variable_get('splash_screen_url')!='node'?drupal_get_path_alias(variable_get('splash_screen_url', 'node')):''),
    '#field_prefix' => url(NULL, array('absolute' => TRUE)) . (variable_get('clean_url', 0) ? '' : '?q='),
  ); 
 
  return system_settings_form($form);
}

/**
 * Implements hook_permission().
 */
function splash_screen_permission() {
  return array(
    'administer splash screen' => array(
      'title' => t('Administer splash screen'), 
      'description' => t('Administrer full settings of the splash screen module.'),
    ),
  );
}
