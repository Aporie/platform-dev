<?php
/**
 * @file
 * Code for the Multi-user blog feature.
 */

include_once 'multi_user_blog.features.inc';

/*
* hook_views_pre_render
*/
function multi_user_blog_views_pre_render(&$view) {
  global $user;
  
  if ($view->name=='blog') {
    switch($view->current_display) {
      case 'blog_list_page':
        if ( user_access('create blog_post content') ) {
          $output = l(t('Create blog post'), 
              'node/add/blog-post',
          array('attributes' => array('type' => 'add', 'action_bar' => 'single', 'btn_group' => 'single')));
          $view->header['area']->options['content'] = $view->header['area']->options['content'] . $output;
        }      
        break;
      
      case 'user_blog_page':
        if ( user_access('create blog_post content') && arg(1) == $user->uid ) {
          $output = l(t('Create blog post'), 
              'node/add/blog-post',
          array('attributes' => array('type' => 'add', 'action_bar' => 'single', 'btn_group' => 'single')));
          $view->header['area']->options['content'] = $view->header['area']->options['content'] . $output;
        }
        break;
      default:
        break;
    }  
  }
}


/**
 * Implementation of hook_token_info().
 */
function multi_user_blog_token_info() {
    $info['types']['Breadcrumb_multi_user_blog'] = array(
        'name' => 'Breadcrumb_multi_user_blog',
        'description' => 'Tokens related to Breadcrumb.',
    );
    $info['tokens']['Breadcrumb_multi_user_blog']["multi_user_blog_title"] = array(
        'name' => t("Multi user blog Breadcrumb title"),
        'description' => t("The Breadcrumb title of the multi user blog."),
    );
    return $info;
}

/**
 * Implements hook_tokens().
 */
function multi_user_blog_tokens($type, $tokens, $data = array(), $options = array()) {
    $replacements = array();
    $sanitize = !empty($options['sanitize']);
    // tokens for e_libray_core Breadcrumb
    if ($type == 'Breadcrumb_multi_user_blog') {
        foreach ($tokens as $name => $original) {
            switch ($name) {
                case 'multi_user_blog_title':
                    $replacements[$original] = t("blog");
                    break;
            }
        }
    }
    return $replacements;
}
