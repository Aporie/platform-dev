<?php
/**
 * @file
 * Code for the Survey feature.
 */

include_once('survey_core.features.inc');


/*
* hook_menu
*/
function survey_core_menu() {
  $items = array();
 
  $items['survey_analysis/%'] = array(
    'title' => 'Analysis',
    'page callback' => 'survey_analysis',
    'page arguments' => array(1),
    'access callback' => TRUE,
    'weight' => 5,
  );

  return $items;
}


/*
* display analysis results of a webform
*/
function survey_analysis($nid) {
  $node = node_load($nid);
  $sids = array();
  $components = $node->webform['components'];
  $data = array();
  foreach ($components as $cid => $component) {
    if ($row_data = webform_component_invoke($component['type'], 'analysis', $component, $sids, FALSE)) {
      $data[$cid] = $row_data;
    }
  }
  return theme('webform_results_analysis', array('node' => $node, 'data' => $data, 'sids' => $sids, 'component' => NULL));
}

