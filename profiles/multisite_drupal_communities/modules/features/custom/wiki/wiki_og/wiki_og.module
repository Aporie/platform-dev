<?php
/**
 * @file
 */

include_once('wiki_og.features.inc'); 
include_once('wiki_og.views_alter.inc');

/*
* hook_menu
*/
function wiki_og_menu() {
  $items = array();
 
  $items['community/%group_name/wiki'] = array(
    'title' => 'Wikis',
    'page callback' => 'views_page',
    'page arguments' => array('wiki_list', 'page_1', 1),
    'access callback' => TRUE,
    'type' => MENU_NORMAL_ITEM,
    'menu_name' => 'menu-communities-menu',
    'weight' => 1,
  );

  return $items;
}



/**
* Implements hook_element_info_alter().
*
* Sets the text format processor to a custom callback function.
* This code is taken from the Better Formats module.
*/

/*
function wiki_og_element_info_alter(&$type) {
  if (isset($type['text_format']['#process'])) {
    foreach ($type['text_format']['#process'] as &$callback) {
      if ($callback === 'filter_process_format') {
        $callback = 'wiki_format_filter_process_format';
      }
    }
  }
}
*/

/*
* hook_filter_process_format
*/

/*
function wiki_og_format_filter_process_format($element) {
  $element = filter_process_format($element);
  if(isset($element['#bundle'])) {
    // Change the default text format of the 'body' field to ' wiki'.
    if ($element['#bundle'] == 'wiki' && $element['#field_name'] == 'body') {
      $element['format']['format']['#default_value'] = 'wiki';
    }
  }
  return $element;
}
*/



/*
* hook_views_pre_render
*/
function wiki_og_views_pre_render(&$view) {
  if ($view->name == 'wiki_list' && $view->current_display == 'page_1') {
    $og = og_context();
    if (og_user_access($og->gid, 'create wiki content'))  {
      $output = l(t('Create a new wiki'), 'node/add/wiki', array('query' => array('gids_node[]' => $og->etid), 'attributes' => array('type' => 'add', 'action_bar' => 'last', 'btn_group' => 'single')));
      $view->header['area']->options['content'] = $output;
    }
  }
}

